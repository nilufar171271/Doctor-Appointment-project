SELECT DATE_FORMAT(a.date, '%d-%m-%Y')as date,a.id as prescription_id,b.full_name as doctor_name,c.full_name as patient_name,(SELECT count(d.prescript_id) FROM prescript_test_details d WHERE status=0 group by d.prescript_id having d.prescript_id=a.id )as notest FROM prescription a,doctor b,patient c where a.id IN(SELECT prescript_id FROM prescript_test_details WHERE status=0 group by prescript_id) and a.doctor_id=b.id and a.patient_id=c.id